document.addEventListener('DOMContentLoaded',()=>{const p=new URLSearchParams(location.search);const id=parseInt(p.get('id')||'1');const q=quests.find(x=>x.id===id);if(!q)return location.href='map.html';const c=document.getElementById('questContainer');c.innerHTML=`<h1 class="text-2xl font-bold mb-3">${q.title}</h1><p class="mb-4 italic">${q.narrative}</p><p class="mb-8">${q.description}</p>`;const qTpl=document.getElementById('questionTpl');const oTpl=document.getElementById('optionTpl');let correct=0;q.quiz.forEach((qq,i)=>{const qN=qTpl.content.cloneNode(true);qN.querySelector('h4').textContent=qq.q;const ul=qN.querySelector('ul');qq.options.forEach(opt=>{const o=oTpl.content.cloneNode(true);const btn=o.querySelector('button');btn.textContent=opt;btn.onclick=()=>{if(btn.dataset.ans)return;btn.dataset.ans=true;if(opt===qq.answer){btn.classList.add('correct');correct++;}else btn.classList.add('wrong');if(correct===q.quiz.length){completeQuest(q.id,q.badge.id);setTimeout(()=>location.href='map.html',600);} };ul.appendChild(o);});c.appendChild(qN);});});
